2025-06-18 15:01:31,810 - DEBUG - [chat_core:169] [HANDLE] Mensaje recibido: hola, dame los datos del abonado con dni 12345678A
2025-06-18 15:01:31,811 - DEBUG - [chat_core:173] [HANDLE] Contexto actualizado: {'dni': '12345678A'}
2025-06-18 15:01:33,393 - DEBUG - [chat_core:193] [HANDLE] Tool calls solicitados: ['datos_abonado']
2025-06-18 15:01:33,394 - DEBUG - [chat_core:87] [TOOL] Validando llamadas: ['datos_abonado']
2025-06-18 15:01:33,394 - DEBUG - [chat_core:91] [TOOL] Detectada consulta general
2025-06-18 15:01:33,394 - DEBUG - [chat_core:144] [TOOL] Argumentos parseados para datos_abonado: {'dni': '12345678A', 'poliza': None}
2025-06-18 15:01:33,395 - DEBUG - [chat_core:125] [TOOL] Validando argumentos para datos_abonado: {'dni': '12345678A', 'poliza': None}
2025-06-18 15:01:33,395 - DEBUG - [chat_core:154] [TOOL] Llamando endpoint: /datos_abonado con args: {'dni': '12345678A', 'poliza': None}
2025-06-18 15:01:36,027 - DEBUG - [chat_core:158] [TOOL] Respuesta de datos_abonado: {'nombre': 'Juan Pérez', 'dni': '12345678A', 'direccion': 'Calle Falsa 123', 'correo': 'juan@example.com', 'telefono': '123456789', 'poliza': 'POL123'}
2025-06-18 15:01:38,597 - DEBUG - [chat_core:169] [HANDLE] Mensaje recibido: dame todas sus facturas
2025-06-18 15:01:38,598 - DEBUG - [chat_core:173] [HANDLE] Contexto actualizado: {'dni': '12345678A', 'query_type': 'factura'}
2025-06-18 15:01:39,440 - DEBUG - [chat_core:193] [HANDLE] Tool calls solicitados: ['todas_las_facturas']
2025-06-18 15:01:39,440 - DEBUG - [chat_core:87] [TOOL] Validando llamadas: ['todas_las_facturas']
2025-06-18 15:01:39,441 - DEBUG - [chat_core:144] [TOOL] Argumentos parseados para todas_las_facturas: {'dni': '12345678A'}
2025-06-18 15:01:39,442 - DEBUG - [chat_core:125] [TOOL] Validando argumentos para todas_las_facturas: {'dni': '12345678A'}
2025-06-18 15:01:39,442 - DEBUG - [chat_core:130] [TOOL] Detectada consulta referencial - Forzando DNI del contexto
2025-06-18 15:01:39,443 - DEBUG - [chat_core:154] [TOOL] Llamando endpoint: /todas_las_facturas con args: {'dni': '12345678A'}
2025-06-18 15:01:42,877 - DEBUG - [chat_core:158] [TOOL] Respuesta de todas_las_facturas: {'facturas': [{'fecha': '2025-06-10', 'estado': 'Pendiente', 'importe': 200.75}, {'fecha': '2025-06-01', 'estado': 'Pagado', 'importe': 100.5}]}
2025-06-18 15:01:54,025 - DEBUG - [chat_core:169] [HANDLE] Mensaje recibido: dame todos los datos del 87654321B
2025-06-18 15:01:54,027 - DEBUG - [chat_core:173] [HANDLE] Contexto actualizado: {'dni': '87654321B', 'query_type': 'factura'}
2025-06-18 15:01:54,677 - DEBUG - [chat_core:193] [HANDLE] Tool calls solicitados: ['datos_abonado']
2025-06-18 15:01:54,678 - DEBUG - [chat_core:87] [TOOL] Validando llamadas: ['datos_abonado']
2025-06-18 15:01:54,678 - DEBUG - [chat_core:91] [TOOL] Detectada consulta general
2025-06-18 15:01:54,679 - DEBUG - [chat_core:144] [TOOL] Argumentos parseados para datos_abonado: {'dni': '87654321B'}
2025-06-18 15:01:54,679 - DEBUG - [chat_core:125] [TOOL] Validando argumentos para datos_abonado: {'dni': '87654321B'}
2025-06-18 15:01:54,680 - DEBUG - [chat_core:154] [TOOL] Llamando endpoint: /datos_abonado con args: {'dni': '87654321B'}
2025-06-18 15:01:58,039 - DEBUG - [chat_core:158] [TOOL] Respuesta de datos_abonado: {'nombre': 'Ana López', 'dni': '87654321B', 'direccion': 'Avenida Siempre Viva 456', 'correo': 'ana@example.com', 'telefono': '987654321', 'poliza': 'POL456'}
2025-06-18 15:02:04,308 - DEBUG - [chat_core:169] [HANDLE] Mensaje recibido: y dame todas sus facturas
2025-06-18 15:02:04,309 - DEBUG - [chat_core:173] [HANDLE] Contexto actualizado: {'dni': '87654321B', 'query_type': 'factura'}
2025-06-18 15:02:04,643 - ERROR - [chat_core:208] [ERROR] Error general: Error code: 429 - {'error': {'message': 'Rate limit reached for model `llama3-70b-8192` in organization `org_01jxew8s64ez0v76tpjs50z5c7` service tier `on_demand` on tokens per day (TPD): Limit 500000, Used 501053, Requested 266. Please try again in 3m47.9796s. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
